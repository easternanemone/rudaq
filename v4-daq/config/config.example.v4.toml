# Rust DAQ V4 - Example Configuration
#
# This is a complete example showing all supported configuration options.
# Copy this file to config/config.v4.toml and customize for your deployment.
#
# For detailed documentation, see: docs/deployment/CONFIGURATION_REFERENCE.md
#
# Date: 2025-11-17
# Version: 1.0

################################################################################
# APPLICATION CONFIGURATION
################################################################################

[application]
# Application name (used in logs and monitoring)
name = "rust-daq-lab"

# Logging level: trace, debug, info, warn, error
# Production: "info"
# Staging: "debug"
# Development: "trace"
log_level = "info"

# Root data directory
# Must be readable/writable by 'rustdaq' user
data_dir = "/var/lib/rust-daq"


################################################################################
# ACTOR SYSTEM CONFIGURATION
################################################################################

[actors]
# Maximum pending messages per actor mailbox
# Increase for high-throughput applications, decrease for low-memory systems
# Typical range: 50-500
default_mailbox_capacity = 100

# Timeout (ms) for actor spawning
# Includes hardware initialization time
# Increase if hardware init is slow (>2s)
spawn_timeout_ms = 5000

# Timeout (ms) for graceful shutdown per actor
# Hardware must release resources within this time
shutdown_timeout_ms = 5000


################################################################################
# STORAGE CONFIGURATION
################################################################################

[storage]
# Default storage backend
# - "arrow": Apache Arrow IPC format (fast, columnar)
# - "hdf5": HDF5 format (hierarchical, large files)
# - "both": Write to both backends simultaneously
default_backend = "hdf5"

# Output directory for data files
# Must be readable/writable by 'rustdaq' user
output_dir = "/var/lib/rust-daq/data"

# Compression level (0-9)
# 0: no compression (fastest)
# 6: good balance (default)
# 9: maximum compression (slowest)
compression_level = 6

# Auto-flush interval (seconds)
# 0: manual flush only
# >0: auto-flush every N seconds
# Larger = better throughput, smaller = fresher data on disk
auto_flush_interval_secs = 60


################################################################################
# INSTRUMENT CONFIGURATION
################################################################################

# Generic SCPI Instrument (e.g., power meter, oscilloscope, signal generator)
# Supports GPIB, USB, Ethernet (VISA) protocols
[[instruments]]
id = "scpi_meter"
type = "ScpiInstrument"
enabled = true

[instruments.config]
# VISA resource string
# Examples:
# - Ethernet: "TCPIP0::192.168.1.100::INSTR"
# - GPIB: "GPIB0::20::INSTR"
# - USB: "USB0::0x0699::0x0346::C123456::INSTR"
# - Serial: "ASRL1::INSTR"
resource = "TCPIP0::192.168.1.100::INSTR"

# Command timeout in milliseconds
timeout_ms = 2000

# Optional: command terminator (default: "\n")
# terminator = "\n"

# Optional: response delimiter (default: "\n")
# response_delimiter = "\n"


# Newport ESP300 Motion Controller
# 3-axis multi-function motion controller
[[instruments]]
id = "esp300_stage"
type = "ESP300"
enabled = true

[instruments.config]
# Serial port path
# Find available ports: ls /dev/ttyUSB* or ls /dev/ttyACM*
serial_port = "/dev/ttyUSB0"

# Number of axes (1-3)
# Typical: 3 (X, Y, Z stage)
axes = 3

# Note: Baud rate is fixed at 19200 baud (hardware requirement)
# Note: Flow control is hardware (RTS/CTS) - required


# Photometrics Prime Camera
# High-speed camera with optional GPU acceleration
[[instruments]]
id = "pvcam_main"
type = "PVCAMInstrument"
enabled = true

[instruments.config]
# Camera name in PVCAM system
# Discover with: pvcam_list_cameras
# Examples: "PrimeBSI", "PrimeSC", "Prime95B"
camera_name = "PrimeBSI"

# Sensor temperature setpoint (Celsius)
# Typical: -20 to -40 (cold operation for low noise)
# temperature_setpoint = -20.0

# Frame acquisition timeout (milliseconds)
# Increase if frame processing is slow
# frame_timeout_ms = 5000

# Optional: ROI (Region of Interest) configuration
# Reduce image size for higher frame rate
# roi_width = 2048
# roi_height = 2048
# roi_x = 0
# roi_y = 0


# Newport 1830-C Optical Power Meter
# Wavelength-calibrated power measurement
[[instruments]]
id = "newport_1830c"
type = "Newport1830C"
enabled = true

[instruments.config]
# VISA resource string for serial port
# Find available: visainfo | grep ASRL
resource = "ASRL1::INSTR"

# Wavelength in nanometers (for calibration)
# Common values: 635, 785, 850, 1064, 1310, 1550 nm
# Default: 1550 (C-band telecom)
wavelength_nm = 1550.0

# Command timeout (milliseconds)
timeout_ms = 2000

# Auto-ranging (optional, typical: true)
# Automatically select best measurement range
# auto_range = true

# Measurement units (optional, default: "dBm")
# Valid: "dBm", "mW"
# units = "dBm"


# Spectra-Physics MaiTai Tunable Laser
# Wavelength-tunable Ti:Sapphire laser
# WARNING: Laser safety considerations apply
[[instruments]]
id = "maitai_laser"
type = "MaiTai"
enabled = true

[instruments.config]
# Serial port path
# Find available ports: ls /dev/ttyUSB* or ls /dev/ttyACM*
serial_port = "/dev/ttyUSB1"

# Note: Baud rate is fixed at 115200 baud (hardware requirement)
# Note: Flow control is typically disabled

# Command timeout (milliseconds)
# MaiTai can be slow (~200ms) due to laser physics
# timeout_ms = 2000

# Optional: Shutter default state on startup
# true = open, false = closed (safe default)
# shutter_open_on_startup = false

# Optional: Wavelength range constraints
# min_wavelength = 690.0
# max_wavelength = 1040.0


################################################################################
# ENVIRONMENT VARIABLE OVERRIDES
################################################################################

# Configuration values can be overridden by environment variables.
# Set variables with prefix RUST_DAQ_ and use _ for nested structure.
#
# Examples:
#   export RUST_DAQ_APPLICATION_NAME="field-deployment"
#   export RUST_DAQ_APPLICATION_LOG_LEVEL="debug"
#   export RUST_DAQ_ACTORS_DEFAULT_MAILBOX_CAPACITY="200"
#   export RUST_DAQ_INSTRUMENTS_0_CONFIG_SERIAL_PORT="/dev/ttyUSB2"
#
# Environment variables override TOML configuration.
# Useful for deployment-specific settings.


################################################################################
# COMMON DEPLOYMENT SCENARIOS
################################################################################

# SCENARIO 1: Development (Extra logging, short timeouts)
# Uncomment to use:
#
# [application]
# log_level = "debug"
#
# [actors]
# spawn_timeout_ms = 10000  # More lenient
# shutdown_timeout_ms = 10000
#
# [storage]
# default_backend = "arrow"  # Faster for testing
# compression_level = 0


# SCENARIO 2: High-Throughput (Large buffers, batched storage)
# Uncomment to use:
#
# [actors]
# default_mailbox_capacity = 500  # Larger buffers
#
# [storage]
# compression_level = 0  # No compression
# auto_flush_interval_secs = 120  # Batch flushes


# SCENARIO 3: Low-Memory System (Small buffers, aggressive compression)
# Uncomment to use:
#
# [actors]
# default_mailbox_capacity = 20  # Minimal
#
# [storage]
# compression_level = 9  # Maximum compression
# default_backend = "arrow"  # More efficient


################################################################################
# NOTES AND TROUBLESHOOTING
################################################################################

# Serial Port Persistence:
#   - Device names like /dev/ttyUSB0 can change between reboots
#   - Use udev rules for persistent naming (see docs)
#   - Or, identify by USB VID:PID in udev

# VISA Resource Strings:
#   - List available: visainfo
#   - Format varies by connection type
#   - Example: "TCPIP0::192.168.1.100::RAW::5025::SOCKET"

# Hardware Timeouts:
#   - Increase if network is congested (SCPI)
#   - Increase if hardware is slow to initialize
#   - Typical values: 2000-5000ms

# Data Directory Permissions:
#   - Must be owned by 'rustdaq' user
#   - Must have write permissions
#   - Check: ls -la /var/lib/rust-daq/

# For detailed configuration reference, see:
# docs/deployment/CONFIGURATION_REFERENCE.md
#
# For troubleshooting, see:
# docs/deployment/TROUBLESHOOTING.md
#
# For deployment guide, see:
# docs/deployment/PRODUCTION_DEPLOYMENT_GUIDE.md
